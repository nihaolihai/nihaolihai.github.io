(window.webpackJsonp=window.webpackJsonp||[]).push([[339],{826:function(n,t,e){"use strict";e.r(t);var r=e(6),i=Object(r.a)({},(function(){var n=this.$createElement,t=this._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":this.$parent.slotKey}},[t("h2",{attrs:{id:"spring-cloud使用turbine实现集群监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud使用turbine实现集群监控"}},[this._v("#")]),this._v(" Spring Cloud使用Turbine实现集群监控")]),this._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('Turbine 使用\nTurbine 是聚合服务器发送事件流数据的一个工具。Hystrix 只能监控单个节点，然后通过 dashboard 进行展示。实际生产中都为集群，这个时候我们可以通过 Turbine 来监控集群下 Hystrix 的 metrics 情况，通过 Eureka 来发现 Hystrix 服务。\n\n本节在介绍 Turbine 的用法时就不再单独创建一个新项目了，在之前的 hystrix-dashboard-demo 中进行修改来支持 Turbine 即可。\n\n首先增加 Turbine 的依赖，代码如下所示。\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-turbine</artifactId>\n</dependency>\n\n在启动类上增加 @EnableTurbine 和 @EnableDiscoveryClient。在属性文件中配置如下内容：\neureka.client.serviceUrl.defaultZone=http://zhangsan:123456@localhost:8761/eureka/\nturbine.appConfig=hystrix-feign-demo\nturbine.aggregator.clusterConfig=default\nturbine.clusterNameExpression=new String("default")\n\n其中：\nturbine.appConfig：配置需要聚合的服务名称。\nturbine.aggregator.clusterConfig：Turbine 需要聚合的集群名称。\nturbine.clusterNameExpression：集群名表达式。\n\n这里用默认的集群名称 default。\n\n重启服务，就可以使用 http://localhost:9011/turbine.stream 来访问集群的监控数据了。Turbine 会通过在 Eureka 中查找服务的 homePageUrl 加上 hystrix.stream 来获取其他服务的监控数据，并将其汇总显示。\ncontext-path 导致监控失败\n如果被监控的服务中设置了 context-path，则会导致 Turbine 无法获取监控数据，如图 1 所示。\n\ndashboard数据监控失败页面\n图 1  dashboard 数据监控失败页面\n\n这个时候需要在 Turbine 中指定 turbine.instanceUrlSuffix 来解决这个问题：\nturbine.instanceUrlSuffix=/sub/hystrix.stream\n\nsub 用于监控服务的 context-path。上面这种方式是全局配置，会有一个问题，就是一般我们在使用中会用一个集群去监控多个服务，如果每个服务的 context-path 都不一样，这个时候有一些就会出问题，那么就需要对每个服务做一个集群，然后配置集群对应的 context-path：\nturbine.instanceUrlSuffix. 集群名称 =/sub/hystrix.stream\n\n\n')])])])])}),[],!1,null,null,null);t.default=i.exports}}]);